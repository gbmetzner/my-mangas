var myMangas=angular.module("myMangas",["ngRoute","ngCookies","ui.bootstrap","ngFileUpload","myMangas.tpl","akoenig.deckgrid","publisher.controllers","publisher.routes","collection.controllers","collection.routes","manga.controllers","manga.routes","login.controllers","login.directives","messages.directives","errors.routes"]).config(["$provide","$httpProvider","$locationProvider",function(e,t,n){n.html5Mode({enabled:!0,requireBase:!1}),e.factory("HttpInterceptor",["$q",function(e){return{request:function(t){return t||e.when(t)},requestError:function(t){switch(alert(t.status),t.status){case 404:$location.path("/404");break;default:$location.path("/error")}return e.reject(t)},response:function(t){return t||e.when(t)},responseError:function(t){return e.reject(t)}}}]),t.interceptors.push("HttpInterceptor")}]);angular.module("collection.controllers",["collection.services","publisher.services","ngDialog"]).controller("NewCollectionController",["$scope","CollectionService","PublisherService",function(e,t,n){e.getPublishers=function(e){return n.findByName(e).then(function(e){return e.data.items.map(function(e){return e.name})})},e.legend="Add New Collection",e.save=function(n){e.collectionForm.$valid&&t.save(n).then(function(t){e.reset(),e.alerts.push({type:"success",msg:t.data.msg})},function(t){e.alerts.push({type:"warning",msg:t.data.msg})})},e.reset=function(){e.collection={publisher:"",name:"",searchParam:"",isComplete:!1}}}]).controller("ListCollectionController",["$scope","$timeout","CollectionService","ngDialog",function(e,t,n,a){var o,r={publisher:"",name:""};e.$watchGroup(["collection.publisher","collection.name"],function(e){(e[0]||e[1])&&(o&&t.cancel(o),o=t(function(){r={publisher:e[0]?e[0]:"",name:e[1]?e[1]:""},i(1,0)},350))}),e.openRemoveDialog=function(t){e.item=t,e.type="Collection",a.openConfirm({template:"/partials/templates/remove_dialog.html",className:"ngdialog-theme-default",scope:e}).then(function(t){n.remove(t).then(function(t){i(e.bigCurrentPage,e.itemsPerPage*(e.bigCurrentPage-1)),e.alerts.push({type:"success",msg:t.data.msg})},function(t){e.alerts.push({type:"warning",msg:t.data.msg})})},function(){})};var i=function(t,a){e.itemsPerPage=10,e.maxSize=5,e.bigCurrentPage=t,n.paginate({collection:r,limit:e.itemsPerPage,skip:a}).then(function(t){e.collections=t.data.items,e.bigTotalItems=t.data.totalRecords},function(e){})};e.setPage=function(t){e.bigCurrentPage=t},e.pageChanged=function(){i(e.bigCurrentPage,e.itemsPerPage*(e.bigCurrentPage-1))},i(1,0)}]).controller("UpdateCollectionController",["$scope","$routeParams","CollectionService",function(e,t,n){e.legend="Update Collection";var a=null,o=function(){n.edit(t.id).then(function(t){e.collection=t.data.collection,a=angular.copy(e.collection)},function(t){e.alerts.push({type:"warning",msg:t.data.msg})})};o(),e.save=function(t){e.collectionForm.$valid&&n.update(t).then(function(t){a=angular.copy(e.collection),e.alerts.push({type:"success",msg:t.data.msg})},function(t){e.alerts.push({type:"warning",msg:t.data.msg})})},e.reset=function(){o()}}]),angular.module("errors.controllers",[]).controller("ErrorController",["$scope",function(e){}]),angular.module("login.controllers",["login.services","ngDialog","myMangas.tpl","ngCookies"]).controller("LoginController",["$scope","$cookies","LoginService","ngDialog",function(e,t,n,a){var o=!1,r=t["XSRF-TOKEN"];e.form={},r&&n.logged().then(function(t){e.name=t.data.user.name,o=!0},function(e){o=!1});var i=function(t){e.message=t,a.open({template:"/partials/templates/info_dialog.html",className:"ngdialog-theme-default",scope:e})};e.isAuthenticated=function(){return o},e.login=function(t){e.form.loginForm.$valid&&n.login(t).then(function(t){r=t.data.token,e.name=t.data.user.name,o=!0},function(e){o=!1,i(e.data.msg)})},e.logout=function(){n.logout().then(function(t){i(t.data.msg),e.name=void 0,o=!1},function(e){o=!1})}}]),angular.module("manga.controllers",["manga.services","collection.services","ngDialog","myMangas.tpl"]).controller("NewMangaController",["$scope","MangaService","CollectionService",function(e,t,n){e.legend="Add New Manga",e.showUploadCover=!1,e.getCollections=function(e){return n.findByName(e).then(function(e){return e.data.items.map(function(e){return e.name})})},e.save=function(n){e.mangaForm.$valid&&t.save(n).then(function(t){e.reset(),e.alerts.push({type:"success",msg:t.data.msg})},function(t){e.alerts.push({type:"warning",msg:t.data.msg})})},e.reset=function(){e.manga={collection:"",name:"",number:"",doIHaveIt:!1}}}]).controller("ListMangaController",["$scope","$timeout","MangaService","ngDialog",function(e,t,n,a){var o,r={collection:"",name:""};e.$watchGroup(["manga.collection","manga.name"],function(e){(e[0]||e[1])&&(o&&t.cancel(o),o=t(function(){r={collection:e[0]?e[0]:"",name:e[1]?e[1]:""},i(1,0)},350))}),e.openRemoveDialog=function(t){e.item=t,e.type="Manga",a.open({template:"/partials/templates/remove_dialog.html",className:"ngdialog-theme-default",scope:e}).then(function(t){n.remove(t).then(function(t){i(e.bigCurrentPage,e.itemsPerPage*(e.bigCurrentPage-1)),e.alerts.push({type:"success",msg:t.data.msg})},function(t){e.alerts.push({type:"warning",msg:t.data.msg})})},function(){})};var i=function(t,a){e.itemsPerPage=10,e.maxSize=5,e.bigCurrentPage=t,n.paginate({manga:r,limit:e.itemsPerPage,skip:a}).then(function(t){e.mangas=t.data.items,e.bigTotalItems=t.data.totalRecords},function(e){})};e.setPage=function(t){e.bigCurrentPage=t},e.pageChanged=function(){i(e.bigCurrentPage,e.itemsPerPage*(e.bigCurrentPage-1))},i(1,0)}]).controller("UpdateMangaController",["$scope","$routeParams","MangaService","CollectionService","Upload",function(e,t,n,a,o){e.showUploadCover=!0,e.legend="Update Manga",e.getCollections=function(e){return a.findByName(e).then(function(e){return e.data.items.map(function(e){return e.name})})};var r=null,i=function(){n.edit(t.id).then(function(t){e.manga=t.data.manga,r=angular.copy(e.manga)},function(t){e.alerts.push({type:"warning",msg:t.data.msg})})};i(),e.save=function(t){e.mangaForm.$valid&&n.update(t).then(function(t){r=angular.copy(e.manga),e.alerts.push({type:"success",msg:t.data.msg})},function(t){e.alerts.push({type:"warning",msg:t.data.msg})})},e.reset=function(){i()},e.uploadCover=function(t,n){o.upload({url:"/api/mangas/cover/upload?mangaID="+n.id+"&directory="+n.collection+"&originalname="+n.collection+"_"+n.number,data:{file:t}}).then(function(t){e.alerts.push({type:"success",msg:t.data.msg})},function(t){e.alerts.push({type:"warning",msg:t.data.msg})},function(e){})}}]).controller("DeckMangaController",["$scope","$timeout","MangaService",function(e,t,n){e.mangas=[];var a,o="";e.$watch("collection",function(e){e&&(a&&t.cancel(a),a=t(function(){o=e,r(1,0)},350))});var r=function(t,a){e.itemsPerPage=20,e.maxSize=5,e.bigCurrentPage=t,n.paginate({manga:{collection:o,name:""},limit:e.itemsPerPage,skip:a}).then(function(t){e.mangas=t.data.items,e.bigTotalItems=t.data.totalRecords},function(e){})};e.setPage=function(t){e.bigCurrentPage=t},e.pageChanged=function(){r(e.bigCurrentPage,e.itemsPerPage*(e.bigCurrentPage-1))},r(1,0)}]),angular.module("publisher.controllers",["publisher.services","ngDialog"]).controller("NewPublisherController",["$scope","PublisherService",function(e,t){e.legend="Add New Publisher",e.save=function(n){e.publisherForm.$valid&&t.save(n).then(function(t){e.reset(),e.alerts.push({type:"success",msg:t.data.msg})},function(t){e.alerts.push({type:"warning",msg:t.data.msg})})},e.reset=function(){e.publisher={name:""}}}]).controller("ListPublisherController",["$scope","$route","$timeout","PublisherService","ngDialog",function(e,t,n,a,o){var r,i="";e.$watch("name",function(e){e&&(r&&n.cancel(r),r=n(function(){i=e,l(1,0)},350))}),e.openRemoveDialog=function(t){e.item=t,e.type="Publisher",o.openConfirm({template:"/partials/templates/remove_dialog.html",className:"ngdialog-theme-default",scope:e}).then(function(t){a.remove(t).then(function(t){l(e.bigCurrentPage,e.itemsPerPage*(e.bigCurrentPage-1)),e.alerts.push({type:"success",msg:t.data.msg})},function(t){e.alerts.push({type:"warning",msg:t.data.msg})})},function(){})};var l=function(t,n){e.itemsPerPage=10,e.maxSize=5,e.bigCurrentPage=t,a.paginate({name:i,limit:e.itemsPerPage,skip:n}).then(function(t){e.publishers=t.data.items,e.bigTotalItems=t.data.totalRecords},function(e){})};e.setPage=function(t){e.bigCurrentPage=t},e.pageChanged=function(){l(e.bigCurrentPage,e.itemsPerPage*(e.bigCurrentPage-1))},l(1,0)}]).controller("UpdatePublisherController",["$scope","$routeParams","PublisherService",function(e,t,n){e.legend="Update Publisher";var a=null,o=function(){n.edit(t.id).then(function(t){e.publisher=t.data.publisher,a=angular.copy(e.publisher)},function(t){e.alerts.push({type:"warning",msg:t.data.msg})})};o(),e.save=function(t){e.publisherForm.$valid&&n.update(t).then(function(t){a=angular.copy(e.publisher),e.alerts.push({type:"success",msg:t.data.msg})},function(t){e.alerts.push({type:"warning",msg:t.data.msg})})},e.reset=function(){o()}}]),angular.module("login.directives",[]).directive("appHeader",function(){var e={"true":!0,"false":!1};return{restrict:"E",link:function(t,n,a){a.$observe("isauthenticated",function(n,a){e[n]?t.headerUrl="/assets/partials/login/logged.html":t.headerUrl="/assets/partials/login/not_logged.html"})},template:'<div ng-include="headerUrl"></div>'}}),angular.module("messages.directives",[]).directive("messages",["$timeout",function(e){return{restrict:"E",link:function(e,t,n){e.alerts=[];e.closeAlert=function(t){e.alerts.splice(t,1)}},templateUrl:"/partials/templates/messages.html"}}]),angular.module("collection.routes",["collection.controllers"]).config(["$routeProvider",function(e){e.when("/views/collection",{templateUrl:"/partials/collections/collection.html",controller:"NewCollectionController"}).when("/views/collections",{templateUrl:"/partials/collections/collections.html",controller:"ListCollectionController"}).when("/views/collection/:id/edit",{templateUrl:"/partials/collections/collection.html",controller:"UpdateCollectionController"})}]),angular.module("errors.routes",[]).config(["$routeProvider",function(e){e.when("/404",{templateUrl:"/partials/errors/404.html"}).otherwise("/404")}]),angular.module("manga.routes",["manga.controllers"]).config(["$routeProvider",function(e){e.when("/views/manga",{templateUrl:"/partials/mangas/manga.html",controller:"NewMangaController"}).when("/views/mangas",{templateUrl:"/partials/mangas/mangas.html",controller:"ListMangaController"}).when("/views/manga/:id/edit",{templateUrl:"/partials/mangas/manga.html",controller:"UpdateMangaController"}).when("/",{templateUrl:"/partials/mangas/mangas_deck.html",controller:"DeckMangaController"})}]),angular.module("publisher.routes",["publisher.controllers"]).config(["$routeProvider",function(e){e.when("/views/publisher",{templateUrl:"/partials/publishers/publisher.html",controller:"NewPublisherController"}).when("/views/publishers",{templateUrl:"/partials/publishers/publishers.html",controller:"ListPublisherController"}).when("/views/publisher/:id/edit",{templateUrl:"/partials/publishers/publisher.html",controller:"UpdatePublisherController"})}]),angular.module("collection.services",[]).factory("CollectionService",["$http",function(e){var t=function(t,n){return e({method:"POST",data:n,headers:{"Content-Type":"application/json"},url:t})},n=function(t,n){return e({method:"PUT",data:n,headers:{"Content-Type":"application/json"},url:t})},a=function(t){return e({method:"GET",headers:{"Content-Type":"application/json"},url:t})},o=function(t){return e({method:"DELETE",headers:{"Content-Type":"application/json"},url:t})};return{save:function(e){return t("/api/collections",e)},edit:function(e){return a("/api/collections/"+e+"/edit")},update:function(e){return n("/api/collections/"+e.id,e)},remove:function(e){return o("/api/collections/"+e)},findByName:function(e){return a("/api/collections/search?name="+e+"&limit=10&skip=0")},paginate:function(e){var t="/api/collections/search?";return null!==e.limit&&(t=t+"limit="+e.limit),null!==e.skip&&(t=t+"&skip="+e.skip),""!==e.collection.publisher&&(t=t+"&publisher="+e.collection.publisher),""!==e.collection.name&&(t=t+"&name="+e.collection.name),a(t)}}}]),angular.module("login.services",[]).factory("LoginService",["$http",function(e){return{login:function(t){return e.post("/api/login",t)},logout:function(){return e.put("/api/logout")},logged:function(){return e.get("/api/logged")}}}]),angular.module("manga.services",[]).factory("MangaService",["$http",function(e){var t="/api/mangas";return{save:function(n){return e.post(t,n)},edit:function(n){return e.get(t+"/"+n+"/edit")},update:function(n){return e.put(t+"/"+n.id,n)},remove:function(n){return e["delete"](t+"/"+n)},paginate:function(n){var a="/search?";return n.limit&&(a=a+"limit="+n.limit),n.skip&&(a=a+"&skip="+n.skip),n.manga.collection&&(a=a+"&collection="+n.manga.collection),n.manga.name&&(a=a+"&name="+n.manga.name),e.get(t+a)}}}]),angular.module("publisher.services",[]).factory("PublisherService",["$http",function(e){var t=function(t,n){return e({method:"POST",data:n,headers:{"Content-Type":"application/json"},url:t})},n=function(t,n){return e({method:"PUT",data:n,headers:{"Content-Type":"application/json"},url:t})},a=function(t){return e({method:"GET",headers:{"Content-Type":"application/json"},url:t})},o=function(t){return e({method:"DELETE",headers:{"Content-Type":"application/json"},url:t})};return{save:function(e){return t("/api/publishers",e)},edit:function(e){return a("/api/publishers/"+e+"/edit")},update:function(e){return n("/api/publishers/"+e.id,e)},remove:function(e){return o("/api/publishers/"+e)},findByName:function(e){return a("/api/publishers/search?name="+e+"&limit=10&skip=0")},paginate:function(e){var t="/api/publishers/search?";return null!==e.limit&&(t=t+"limit="+e.limit),null!==e.skip&&(t=t+"&skip="+e.skip),""!==e.name&&(t=t+"&name="+e.name),a(t)}}}]);